{"version":3,"file":"Runner.js","sourceRoot":"","sources":["Runner.ts"],"names":[],"mappings":";;;AAGA;;;;;;;GAOG;AACH,MAAa,MAAM;IACjB,4BAA4B;IAC5B;;;OAGG;IACH,YACkB,OAAyF,EACzF,MAAkD;QADlD,YAAO,GAAP,OAAO,CAAkF;QACzF,WAAM,GAAN,MAAM,CAA4C;QAElE,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,MAAM,IAAI,KAAK,CAAC,8CAA8C,CAAC,CAAC;SACjE;QACD,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YAChB,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;SAChE;IACH,CAAC;IACD,2BAA2B;IAE3B;;;;;OAKG;IACI,KAAK,CAAC,GAAG,CAAC,MAAmB;QAClC,MAAM,OAAO,GACX,MAAM,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;QAClD,OAAO,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;IAC9E,CAAC;IAED;;;;;;OAMG;IACI,UAAU;QACf,OAAO,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;IACpF,CAAC;IAED;;;;;;OAMG;IACI,KAAK,CAAC,YAAY;QACvB,OAAO,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;IACtF,CAAC;IAED;;;;;;;;;;;;;OAaG;IACI,aAAa,CAAC,gBAAwC;QAE3D,MAAM,MAAM,GAA6D,EAAE,CAAC;QAE5E,8BAA8B;QAC9B,KAAK,MAAM,GAAG,IAAI,gBAAgB,EAAE;YAClC,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,MAAM,EAAE;gBAC/B,IAAI,KAAK,CAAC,IAAI,KAAK,gBAAgB,CAAC,GAAG,CAAC,EAAE;oBACxC,MAAM,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;iBACrB;aACF;SACF;QAED,iCAAiC;QACjC,KAAK,MAAM,GAAG,IAAI,gBAAgB,EAAE;YAClC,IAAI,CAAC,CAAC,GAAG,IAAI,MAAM,CAAC,EAAE;gBACpB,MAAM,IAAI,KAAK,CAAC,oBAAoB,GAAG,sBAAsB,gBAAgB,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;aACxF;SACF;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;CACF;AAzFD,wBAyFC","sourcesContent":["import type { ActorInit, IActionInit, IActorOutputInit } from '@comunica/bus-init';\nimport type { Actor, Bus, IAction, IActorOutput, IActorReply, IActorTest } from '@comunica/core';\n\n/**\n * A Runner is used to instantiate a comunica workflow.\n *\n * It is instantiated dynamically using a Components.js config file.\n * A bus and a list of actors are injected into this runner dynamically.\n *\n * The {@link Runner#run} function must be called to instantiate the workflow.\n */\nexport class Runner {\n  /* eslint-disable max-len */\n  /**\n   * @param busInit - The 'init' event bus. @default {<npmd:@comunica/bus-init/^2.0.0/components/ActorInit.jsonld#ActorInit_default_bus>}\n   * @param actors - The list of all actors that are part of the comunica workflow.\n   */\n  public constructor(\n    public readonly busInit: Bus<Actor<IAction, IActorTest, IActorOutput>, IAction, IActorTest, IActorOutput>,\n    public readonly actors: Actor<IAction, IActorTest, IActorOutput>[],\n  ) {\n    if (!this.busInit) {\n      throw new Error('A valid \"busInit\" argument must be provided.');\n    }\n    if (!this.actors) {\n      throw new Error('A valid \"actors\" argument must be provided.');\n    }\n  }\n  /* eslint-enable max-len */\n\n  /**\n   * Run a comunica workflow.\n   *\n   * @param {IActionInit} action An 'init' action.\n   * @return {Promise<void>}     A promise that resolves when the init actors are triggered.\n   */\n  public async run(action: IActionInit): Promise<IActorOutputInit[]> {\n    const replies: IActorReply<ActorInit, IActionInit, IActorTest, IActorOutputInit>[] =\n      await Promise.all(this.busInit.publish(action));\n    return Promise.all(replies.map(reply => reply.actor.runObservable(action)));\n  }\n\n  /**\n   * Initialize the actors.\n   * This should be used for doing things that take a while,\n   * such as opening files.\n   *\n   * @return {Promise<void>} A promise that resolves when the actors have been initialized.\n   */\n  public initialize(): Promise<any> {\n    return Promise.all(this.actors.map(actor => actor.initialize())).then(() => true);\n  }\n\n  /**\n   * Deinitialize the actors.\n   * This should be used for cleaning up things when the application is shut down,\n   * such as closing files and removing temporary files.\n   *\n   * @return {Promise<void>} A promise that resolves when the actors have been deinitialized.\n   */\n  public async deinitialize(): Promise<any> {\n    return Promise.all(this.actors.map(actor => actor.deinitialize())).then(() => true);\n  }\n\n  /**\n   * Collect the given actors that are available in this runner.\n   *\n   * Example:\n   * <pre>\n   *   const { engine } = runner.collectActors({ engine: 'urn:comunica:default:init/actors#query' };\n   *   // engine is an actor instance\n   * </pre>\n   *\n   * An error will be thrown if any of the actors could not be found in the runner.\n   *\n   * @param actorIdentifiers A mapping of keys to actor identifiers.\n   * @return A mapping of keys to actor instances.\n   */\n  public collectActors(actorIdentifiers: Record<string, string>):\n  Record<string, Actor<IAction, IActorTest, IActorOutput>> {\n    const actors: Record<string, Actor<IAction, IActorTest, IActorOutput>> = {};\n\n    // Collect all required actors\n    for (const key in actorIdentifiers) {\n      for (const actor of this.actors) {\n        if (actor.name === actorIdentifiers[key]) {\n          actors[key] = actor;\n        }\n      }\n    }\n\n    // Error if we are missing actors\n    for (const key in actorIdentifiers) {\n      if (!(key in actors)) {\n        throw new Error(`No actor for key ${key} was found for IRI ${actorIdentifiers[key]}.`);\n      }\n    }\n\n    return actors;\n  }\n}\n"]}