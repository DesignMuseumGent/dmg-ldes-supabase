{"version":3,"file":"MediatedQuadSource.js","sourceRoot":"","sources":["MediatedQuadSource.ts"],"names":[],"mappings":";;;AAMA,yGAAsG;AACtG,qEAAkE;AAElE;;;;GAIG;AACH,MAAa,kBAAkB;IAY7B,YAAmB,SAAiB,EAAE,OAAuB,EAAE,QAAgB,EAC7E,eAAmC,EAAE,YAAoB,EAAE,cAAuB,EAAE,SAAwB;QAC5G,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,eAAe,GAAG,eAAe,CAAC;QACvC,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC,CAAC,CAAC,IAAI,+CAAsB,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;QACjF,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;IAC7B,CAAC;IAEM,MAAM,CAAC,gBAAgB,CAAC,IAAe;QAC5C,OAAO,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,KAAK,UAAU,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC;IAClE,CAAC;IAEM,KAAK,CAAC,OAAiB,EAAE,SAAmB,EAAE,MAAgB,EAAE,KAAe;QACpF,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,eAAe,EAAE;YAC7C,OAAO,IAAI,CAAC,eAAe,CAAC,KAAK,CAC/B,kBAAkB,CAAC,gBAAgB,CAAC,OAAO,CAAC,EAC5C,kBAAkB,CAAC,gBAAgB,CAAC,SAAS,CAAC,EAC9C,kBAAkB,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAC3C,kBAAkB,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAC3C,CAAC;SACH;QAED,MAAM,EAAE,GAAG,IAAI,mFAAwC,CACrD,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,OAAO,EACZ,IAAI,CAAC,eAAe,EACpB,OAAO,EACP,SAAS,EACT,MAAM,EACN,KAAK,EACL,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,SAAS,CACf,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,EAAE,CAAC,eAAe,EAAE,CAAC;YACrB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,YAAa,CAAC;SACtC;aAAM;YACL,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SACvC;QACD,OAAO,EAAE,CAAC;IACZ,CAAC;CACF;AA1DD,gDA0DC","sourcesContent":["import type { IQuadSource } from '@comunica/bus-rdf-resolve-quad-pattern';\nimport type { IActionContext } from '@comunica/types';\nimport type * as RDF from '@rdfjs/types';\nimport type { AsyncIterator } from 'asynciterator';\nimport type { ISourcesState } from './LinkedRdfSourcesAsyncRdfIterator';\nimport type { IMediatorArgs } from './MediatedLinkedRdfSourcesAsyncRdfIterator';\nimport { MediatedLinkedRdfSourcesAsyncRdfIterator } from './MediatedLinkedRdfSourcesAsyncRdfIterator';\nimport { StreamingStoreMetadata } from './StreamingStoreMetadata';\n\n/**\n * A lazy quad source that creates {@link MediatedLinkedRdfSourcesAsyncRdfIterator} instances when matching quads.\n *\n * @see MediatedLinkedRdfSourcesAsyncRdfIterator\n */\nexport class MediatedQuadSource implements IQuadSource {\n  public readonly context: IActionContext;\n  public readonly firstUrl: string;\n  public readonly forceSourceType?: string;\n  public readonly mediators: IMediatorArgs;\n\n  public sourcesState: ISourcesState;\n  public aggregatedStore: StreamingStoreMetadata | undefined;\n\n  private readonly cacheSize: number;\n  private readonly maxIterators: number;\n\n  public constructor(cacheSize: number, context: IActionContext, firstUrl: string,\n    forceSourceType: string | undefined, maxIterators: number, aggregateStore: boolean, mediators: IMediatorArgs) {\n    this.cacheSize = cacheSize;\n    this.context = context;\n    this.firstUrl = firstUrl;\n    this.forceSourceType = forceSourceType;\n    this.maxIterators = maxIterators;\n    this.aggregatedStore = aggregateStore ? new StreamingStoreMetadata() : undefined;\n    this.mediators = mediators;\n  }\n\n  public static nullifyVariables(term?: RDF.Term): RDF.Term | undefined {\n    return !term || term.termType === 'Variable' ? undefined : term;\n  }\n\n  public match(subject: RDF.Term, predicate: RDF.Term, object: RDF.Term, graph: RDF.Term): AsyncIterator<RDF.Quad> {\n    if (this.sourcesState && this.aggregatedStore) {\n      return this.aggregatedStore.match(\n        MediatedQuadSource.nullifyVariables(subject),\n        MediatedQuadSource.nullifyVariables(predicate),\n        MediatedQuadSource.nullifyVariables(object),\n        MediatedQuadSource.nullifyVariables(graph),\n      );\n    }\n\n    const it = new MediatedLinkedRdfSourcesAsyncRdfIterator(\n      this.cacheSize,\n      this.context,\n      this.forceSourceType,\n      subject,\n      predicate,\n      object,\n      graph,\n      this.firstUrl,\n      this.maxIterators,\n      this.aggregatedStore,\n      this.mediators,\n    );\n    if (!this.sourcesState) {\n      it.setSourcesState();\n      this.sourcesState = it.sourcesState!;\n    } else {\n      it.setSourcesState(this.sourcesState);\n    }\n    return it;\n  }\n}\n"]}