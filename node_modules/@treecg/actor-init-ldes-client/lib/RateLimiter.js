"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class RateLimiter {
    constructor(minTime) {
        this.nextRequest = {};
        this.minTime = minTime; // in milliseconds
    }
    async planRequest(url) {
        const now = new Date().getTime();
        const domain = new URL(url).host;
        if (!this.nextRequest[domain]) {
            // First request to this domain, allow immediately
            this.nextRequest[domain] = now;
        }
        const difference = this.nextRequest[domain] - now;
        this.nextRequest[domain] = Math.max(now + this.minTime, this.nextRequest[domain] + this.minTime);
        if (difference > 0) {
            await this.sleep(difference);
        }
    }
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}
exports.default = RateLimiter;
//# sourceMappingURL=RateLimiter.js.map